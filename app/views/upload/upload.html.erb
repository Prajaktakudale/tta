<head xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
  <link rel="stylesheet" href="/stylesheet/upload_form.css"> </link>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script type="text/javascript" src="http://jzaefferer.github.com/jquery-validation/jquery.validate.js"></script>
</head>

<%= render :file=> '/home/header.html.erb' %>

<body>

<div class="page_title">
<h1 style="text-align: center; font-family: tahoma,serif;">Upload Test Data</h1>

</div>
<div class="form">
<%= form_tag({:action => 'create' },{ :multipart => true,:id => "uploadForm"}) do %>

       <span><em>Fields marked with (<span class="required-fields">*</span>) are compulsory</em></span>
       <div class="fields" style="padding-top:20px ;">
        <label for="name"> Project Name <span class="required-fields">*</span></label>
        <%= text_field_tag (:project_name) ,nil, :class => 'required' ,:maxlength=>"100" %>
         <br>
       </div>

      <div class="fields" >
        <label for="sub_project_name">Sub-Project name <span class="required-fields">*</span></label>
        <%= text_field_tag (:sub_project_name),nil, :class => 'required',:maxlength=>"100" %>
        <br>
      </div>

      <div class="fields">
        <label for="ci_job_name"> CI Job Name</label>
        <%= text_field_tag ( :ci_job_name) %><br>
      </div>

      <div class="fields">
        <label for="test_category"> Test Category</label>
        <%= text_field_tag ( :test_category) ,nil,:placeholder => '(eg.Unit Test)', :class => 'required'%><br>
      </div>

      <div class="fields">
        <label for="test_report_type"> Test Report Type</label>
        <%= select_tag "test_report_type", "<option>JUnit</option><option>NUnit</option><option>RSpec</option><option>Cucumber</option>".html_safe %> <br>
      </div>

      <div class="fields" >
        <label for="os_name"> OS Tested On <span class="required-fields">*</span></label>
        <%= text_field_tag ( :os_name) ,nil, :class => 'required'%>
         <br>
      </div>

      <div class="fields">
         <label for="host_name">Host-Machine Name <span class="required-fields">*</span></label>
         <%= text_field_tag (:host_name),nil, :class => 'required' %>
        <br>
      </div>

      <div class="fields">
        <label for="browser"> Browser Tested On <span class="required-fields">*</span></label>
        <%= text_field_tag (:browser),nil, :class => 'required' %>
        <br>
      </div>

      <div class="fields">
        <label for="type_of_environment"> Environment Run on <span class="required-fields">*</span></label>
        <%= text_field_tag (:type_of_environment),nil, :class => 'required' %>
        <br>
      </div>

      <div class="fields">
        <label for="date_of_execution"> Date Of Execution <span class="required-fields">*</span></label>
        <div class="required-field date-field">
          <%= text_field_tag (:date_of_execution), nil, :placeholder => 'yyyy-mm-dd', :class => 'required dateISO' %>
          <span class='error-msg'>Please enter a valid Date</span>
        </div>
        <br>
      </div>

      <div class="fields">
        <label for="logDirectory">Directory name</label>
        <%= file_field_tag :logDirectory, {:multiple=>true, :accept => 'application/zip'}%>
      </div>

       <div class="button">
         <button id="submit_button">Submit</button>
         <%= submit_tag nil, {:class=>:"hidden", :id =>"form-submit"}%>
         <!--<%= submit_tag 'SUBMIT',:class=> 'submit', :hidden=>'hidden' %>-->
         <%= submit_tag("Clear All", { :name => 'reset', :id => 'reset_button', :type => "reset" }) %>
      </div>

<% end %>
</div>

</body>
<script>
  $(document).ready(function(){

    var validateDate = function($form){
      var valid = true;
      if(!$form)
        valid = false;
      var dates = $form.find(".date-field input");
      for(index=0,len=dates.length;index<len;index++){
        var dateFields = (dates[index].value).split('-'),
            today = new Date();
        if(dateFields.length != 3 ){
          valid = false;
        }
        if(!parseInt(dateFields[0])||!parseInt(dateFields[1])||!parseInt(dateFields[2])){
          valid=false;
        }
        if(parseInt(dateFields[0]) > parseInt(today.getFullYear()) || parseInt(dateFields[0]) < 1900){
          valid = false;
        }
        if(parseInt(dateFields[1]) > 12 || parseInt(dateFields[1]) < 1){
          valid=false;
        }
        if(parseInt(dateFields[2]) > 31 || parseInt(dateFields[2]) < 1){
          valid = false;
        }
        debugger;
        if(valid === false){
          dates.siblings('.error-msg').show();
          return valid;
        }
      }
      return valid;
    };

    $("#submit_button").on('click',function(){
      if(!validateDate($("#uploadForm"))){         //TODO: Avoid hacks and use a date picker for proper format
        return false;
      }
      $("#form-submit").click();
      return false;
    });
  });
</script>