<head xmlns="http://www.w3.org/1999/html">
  <link rel="stylesheet" href="/stylesheet/upload_form.css"> </link>
</head>


<body>
<%= render :file=> '/home/header.html.erb' %>

<div id="page_title">
  <h1>Pyramid View</h1>

</div>
<% if flash[:no_test_error]!=nil %>
    <p class="error"><%= flash[:no_test_error] %><br></p>
<% end %>
<div id="sub_project_picker">
  <h2>Select Sub-Project to get Test-Pyramid</h2>
  <%= form_tag ({:action => 'sub_project_filter'}) do %>
      <div class="fields" >
        <label for="sub_project">Sub-Project:</label>
        <%= select("sub_project", "id", SubProject.all.collect {|p| [ p.name, p.id ] } ,{:include_blank => true}) %>
        <p class="error"><%= flash[:no_id_error] if flash[:no_id_error] %></p>
        <br>
      </div>
      <div id="submit-project-button">
        <%= submit_tag "Plot" %>
      </div>
  <% end %>
</div>
<% if @json and flash[:no_test_error]==nil %>

    <div id="graph">
      <h4>Test Pyramid for: <%= @sub_project_name %></h4><br><br>
      <div id="legend">
        <p><b>Legend:</b></p>
        <div id="functional">
          <div id="functional_rect">
          </div>
          <p>Functional Tests</p>
        </div>
        <div id="integration">
          <div id="integration_rect">
          </div>
          <p>Integration Tests</p>
        </div>
        <div id="unit">
          <div id="unit_rect">
          </div>
          <p>Unit Tests</p>
        </div>
      </div>
      <div id="pyramid">
      <div id="unit_region">
        <% if @percent_unit_test!="0.00" %>
        <p id="unit_percent"> <%= @percent_unit_test %>%</p>
        <p id="unit_duration"> <%= @duration_unit %>Mins</p>
        <% end %>
        <div id="unit_test">
            <div id="integration_region">
              <% if @percent_integration_test!="0.00" %>
              <p id="integration_percent"> <%= @percent_integration_test %>%</p>
              <p id="integration_duration"> <%= @duration_integration %>Mins</p>
              <% end %>
              <div id="integration_test">
                 <div id="functional_region">
                   <% if @percent_functional_test!="0.00" %>
                   <p id="functional_percent"> <%= @percent_functional_test %>%</p>
                   <p id="functional_duration"> <%= @duration_functional %>Mins</p>
                   <% end %>
                   <div id="functional_test">
                    </div>
                 </div>
              </div>
            </div>
        </div>
      </div>
      </div>

      <script type="text/javascript">
          $(document).ready(function(){
              var regExp = new RegExp("&quot;",'g');
              $("#submit-btn").on('click',function(e){
                  $("#form-submit").trigger('click');
                  var jsonR = ("<%= @json %>");
                  var $j = jsonR;
                  console.log($j);
                  debugger;
                  return false;
              });
          });
      </script>


  </div>
 <%	 end %>

</body>

