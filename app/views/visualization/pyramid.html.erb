<div id="menu-bar">
  <h1>Testing Trend Analysis</h1>
  <a href='/home/index' style="height: 20px; width: 50px; color: #ffffff; margin-right: 10px;">HOME</a>
</div>


<body>
<div id="page_title">
  <h1>Pyramid View</h1>

</div>

<div id="sub_project_picker">
  <h2>Select Project to get Test-Pyramid</h2>
  <%= form_tag ({:action => 'sub_project_filter'}) do %>
      <div class="fields" >
        <label for="sub_project">Project:</label>
        <%= select("sub_project", "id", SubProject.all.collect {|p| [ p.name, p.id ] } ,{:include_blank => true}) %>
        <br>
      </div>
      <div id="submit-project-button">
        <%= submit_tag "Plot" %>
      </div>
  <% end %>

</div>


 <%	 if @jsonData %>
<div id="graph_title">
  <h4>Test Pyramid for Project: <%= @sub_project_name %></h4><br><br>


</div>
<div id="comparative_analysis">
  <script type="text/javascript">

      var pyramidData = <%= raw(@jsonData) %>;

      function pointToString(point) {
          return point.join(',');
      }

      function triangleToString(triangleData) {
          var points = [triangleData.top, triangleData.left, triangleData.right];
          return _.chain(points).map(pointToString).value().join(',');
      }

      function triangleToLabel(triangleData) {
          return triangleData.testType;
      }

      function pyramidToString(pyramidData) {
          return _.chain(pyramidData.triangles.reverse()).map(triangleToString).value();
      }

      function pyramidToLabels(pyramidData) {
          return _.chain(pyramidData.triangles.reverse()).map(triangleToLabel).value();
      }

      var dataset = pyramidToString(pyramidData);

 
      var colors = ['green', 'blue', 'yellow'];
      var testTypes = pyramidToLabels(pyramidData);
      var labelsPosition = [450,300,100];

      var w = h = pyramidData.height;
      var svg = d3.select("body")
              .append("svg")
              .attr("width", w)
              .attr("height", h);

      var pyramid = svg.selectAll("polygon")
              .data(dataset)
              .enter()
              .append("polygon");

      pyramid.attr("points", String)
              .attr("fill", function (d, i) {
                  return colors[i]
              });

      var labels = svg.selectAll("text")
              .data(testTypes)
              .enter()
              .append("text")
              .text(String);

      labels.attr('x', 210).attr('y', function(d, i){
          return labelsPosition[i];


      });
  </script>
</div>

    <div id="percent_label">
      <p style="position: absolute; left:330px ; top:900px"> <%= @percent_unit_test %>%</p>
      <p style="position: absolute; left:400px ; top:730px"> <%= @percent_integration_test %>%</p>
      <p style="position: absolute; left:520px ; top:515px"> <%= @percent_functional_test %>%</p>
    </div>
    <div id="durationLabel">
      <p style="position: absolute; left:900px ; top:900px"> <%= @duration_unit %>Mins</p>
      <p style="position: absolute; left:800px ; top:730px"> <%= @duration_integration %>Mins</p>
      <p style="position: absolute; left:700px ; top:515px"> <%= @duration_functional %>Mins</p>

    </div>
 <%	 end %>

</body>

