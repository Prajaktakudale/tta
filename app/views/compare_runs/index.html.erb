<html>
<head xmlns="http://www.w3.org/1999/html">
  <script type="text/javascript" src="../../assets/javascripts/jquery.validate.js"></script>

</head>

<%= render :file => '/home/header.html.erb' %>
<body>

<div class="page_title">
  <h1>Compare Runs </h1>
</div>
<%= form_tag({:action => 'getCompareJson'}, :id => "compare_runs_form") do %>

    <div id="compare_runs_model">

      <h2> Compare Runs</h2>

      <div class="fields-left">
        <label for="project">Project </label>
        <%= select_tag 'project_id',"",:prompt => "---SELECT PROJECT-----" ,:id => 'project_select', :class =>'required'%>
      </div>

      <div id="div_subproject" class="fields-left" style="display: none;">
        <label for="sub-project">Sub Projects</label>
        <%= select_tag 'sub_projects', "",:prompt => "---SELECT SUB PROJECT-----" , :id => 'sub_project_select',:class =>'required' %>
        </div>

      <div id="div_test_type" class="fields-left" style="display: none;">
      <label for="Test-Types">Test Types </label>
        <%= select_tag 'test_types', "",:prompt => "---SELECT TEST CATEGORY-----" , :id => 'test_types_select', :class => 'required'%>
      </div>

      <div class="fields-left">
        <label for="date1">Date 1</label>
        <%= datepicker_input 'date_one', 'analysis', :dateFormat => "yy-mm-dd", :maxDate => 0, :readonly => "readonly", :placeholder => 'YYYY-MM-DD', :class => 'required' %>
      </div>

      <div class="fields-left">
        <label for="date2">Date 2 </label>
        <%= datepicker_input 'date_two', 'analysis', :dateFormat => "yy-mm-dd", :maxDate => 0, :readonly => "readonly", :placeholder => 'YYYY-MM-DD', :class => 'required' %>
      </div>

      <div id="do-compare">
        <%= submit_tag nil, {:id => "compare_runs"} %>
      </div>

    </div>
<% end %>

</body>
<%= render :file => '/home/footer.html.erb' %>

<script type="text/javascript">
    $(document).ready(function () {

        $("#compare_runs_form").validate();

        var loadProjectData = function (Selector, project_json) {
            jQuery.each(project_json, function (key, projectData) {
                var project_id = projectData["id"];
                var projectName = projectData["name"];
                $(Selector).append(
                        $("<option></option>")
                                .attr("id", project_id)
                                .attr("value", project_id)
                                .text(projectName)
                                .attr("class", "proj-element")
                );
            });
        }

        //ON PAGE LOAD
        var pageLoad = "<%= @projects %>";
        projects = removeQuotsFromJSON.removeQuots(pageLoad);
        projects = JSON.parse(projects);
        console.log(projects);
        loadProjectData("#project_select", projects);


        $(document).delegate("#project_select", "change", function () {
            var project_id = ($("#project_select option:selected").val());
            $.ajax({
                url:"/get_sub_project_data",
                data:{project_id:project_id},
                type:"GET",
                dataType:'json',
                success:function (json_response) {
                    $('.sub-element').remove();
                    $('.test-element').remove();
                    jQuery.each(json_response, function (key, projectData) {
                        var project_id = projectData["id"];
                        var projectName = projectData["name"];
                        $("#sub_project_select").append(
                                $("<option></option>")
                                        .attr("id", project_id)
                                        .attr("value", project_id)
                                        .text(projectName)
                                        .attr("class", "sub-element")
                        );
                    });
                    $("#div_subproject").css("display","block");
                }
            });

        });
        $(document).delegate("#sub_project_select", "change", function () {
            var sub_project_id = ($("#sub_project_select option:selected").val());
            $.ajax({
                url:"/get_test_types",
                data:{subproject_id:sub_project_id},
                type:"GET",
                dataType:'json',
                success:function (json_response) {
                    $('.test-element').remove();
                    jQuery.each(json_response, function (key, testTypes) {
                        var test_type = testTypes["test_category"];
                        $("#test_types_select").append(
                                $("<option></option>")
                                        .attr("id", test_type)
                                        .attr("value", test_type)
                                        .text(test_type)
                                        .attr("class", "test-element")
                        );
                    });
                    $("#div_test_type").css("display","block");
                }
            });
        });
    });
</script>
</html>
