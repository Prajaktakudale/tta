<html>
<head xmlns="http://www.w3.org/1999/html">
</head>

<%= render :file=> '/home/header.html.erb' %>
<body>

<div class="page_title">
  <h1>Compare Runs </h1>
</div>

<div id="compare_runs_form">
  <!--<h2> Compare Runs</h2>-->
  <div class="fields-left" >
    <label for="project" style="margin-left: -420px;">Project </label>
    <select id="project_select">
    <option>---PROJECT----</option></select>
  </div>

  <div class="fields-left">
    <label for="sub-project" style="margin-left: -200px;">Sub Projects</label>
    <select id="sub_project_select" style="margin-right: 50px;">
    <option>---SUB_PROJECT----</option></select>

    <label for="Test-Types">Test Types </label>
    <select id="test_types_select">
    <option>---SUB_PROJECT----</option></select>
  </div>

  <div class="fields-left">
    <label for="date1"style="margin-left: -200px;">Date 1</label>
    <select id="date_one__select">
    <option>---Date ----</option></select>

    <label for="date2">Date 2 </label>
    <select id="date_two_select">
    <option>---Date ----</option></select>
  </div>


</div>
</body>
<%= render :file=> '/home/footer.html.erb' %>
</html>

<script type="text/javascript">
    $(document).ready(function(){

        var loadProjectData=function(project_json){
            jQuery.each(project_json,function(key,projectData){
                var project_id =projectData["id"];
                var projectName = projectData["name"];
                $("#project_select").append(
                        $("<option></option>")
                                .attr("id",project_id)
                                .attr("value",project_id)
                                .text(projectName)
                );
            });
        }

        //ON PAGE LOAD
        var pageLoad= "<%= @projects %>";
        var regExp = new RegExp("&quot;",'g');
        projects = pageLoad.replace(regExp,"\"");
        projects=JSON.parse(projects);
        loadProjectData(projects);


        $(document).delegate("#project_select","change",function(){
            var project_id=($("#project_select option:selected").val());
            $.ajax({
                url : "/get_sub_project_data",
                data :  {project_id :project_id},
                type : "GET",
                dataType :'json',
                success : function(json_response){
                    $('.sub-element').remove();
                    jQuery.each(json_response,function(key,projectData){
                        var project_id =projectData["id"];
                        var projectName = projectData["name"];
                        $("#sub_project_select").append(
                                $("<option></option>")
                                        .attr("id",project_id)
                                        .attr("value",project_id)
                                        .text(projectName)
                                        .attr("class","sub-element")
                        );
                    });

                }
            });

        });
        $(document).delegate("#sub_project_select","change",function(){
            var sub_project_id=($("#sub_project_select option:selected").val());
            $.ajax({
                url : "/get_test_types",
                data :  {subproject_id :sub_project_id},
                type : "GET",
                dataType :'json',
                success : function(json_response){
                    $('.test-element').remove();
                    jQuery.each(json_response,function(key,testTypes){
                        var test_type =testTypes["test_category"];
                        $("#test_types_select").append(
                                $("<option></option>")
                                        .attr("id",test_type)
                                        .attr("value",test_type)
                                        .text(test_type)
                                        .attr("class","test-element")
                        );
                    });

                }
            });

        });


    });
</script>